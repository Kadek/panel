
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>FastApi Apps — Panel 0.12.6 documentation</title>
<link href="../_static/css/theme.css" rel="stylesheet"/>
<link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet"/>
<link href="../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css">
<link href="../_static/css/blank.css" rel="stylesheet" type="text/css">
<link href="../_static/togglebutton.css" rel="stylesheet" type="text/css">
<link href="../_static/mystnb.css" rel="stylesheet" type="text/css">
<link href="../_static/graphviz.css" rel="stylesheet" type="text/css">
<link href="../_static/copybutton.css" rel="stylesheet" type="text/css"/>
<link href="../_static/nbsite.css" rel="stylesheet" type="text/css"/>
<link href="../_static/css/custom.css" rel="stylesheet" type="text/css"/>
<link as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js" rel="preload"/>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
<script src="../_static/jquery.js"></script>
<script src="../_static/underscore.js"></script>
<script src="../_static/doctools.js"></script>
<script src="../_static/togglebutton.js"></script>
<script src="../_static/clipboard.min.js"></script>
<script src="../_static/copybutton.js"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
<link href="../_static/favicon.ico" rel="shortcut icon">
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
</link></link></link></link></link></link></head>
<body data-offset="80" data-spy="scroll" data-target="#bd-toc-nav">
<div class="container-fluid" id="banner"></div>
<nav class="navbar navbar-dark navbar-expand-lg bg-dark fixed-top bd-navbar" id="navbar-main"><div class="container-xl">
<div id="navbar-start">
<a class="navbar-brand" href="../index.html">
<img alt="logo" class="logo" src="../_static/logo_horizontal.png"/>
</a>
</div>
<button aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbar-collapsible" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="col-lg-9 collapse navbar-collapse" id="navbar-collapsible">
<div class="mr-auto" id="navbar-center">
<div class="navbar-center-item">
<ul class="navbar-nav" id="navbar-main-elements">
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../getting_started/index.html">
  Getting Started
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="index.html">
  User Guide
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../gallery/index.html">
  Gallery
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../reference/index.html">
  Reference Gallery
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../developer_guide/index.html">
  Developers
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../api/index.html">
  API
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../releases.html">
  Releases
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../FAQ.html">
  FAQ
 </a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="../about/index.html">
  About
 </a>
</li>
</ul>
</div>
</div>
<div id="navbar-end">
<div class="navbar-end-item">
<ul aria-label="Icon Links" class="navbar-nav" id="navbar-icon-links">
<li class="nav-item">
<a class="nav-link" href="https://github.com/holoviz/panel" rel="noopener" target="_blank" title="GitHub">
<span><i class="fab fa-github-square"></i></span>
<label class="sr-only">GitHub</label>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://twitter.com/Panel_Org" rel="noopener" target="_blank" title="Twitter">
<span><i class="fab fa-twitter-square"></i></span>
<label class="sr-only">Twitter</label>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://discourse.holoviz.org/" rel="noopener" target="_blank" title="Discourse">
<span><i class="fab fa-discourse"></i></span>
<label class="sr-only">Discourse</label>
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</nav>
<div class="container-xl">
<div class="row">
<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="col-12 col-md-2 bd-sidebar"><form action="../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="Search the docs ..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search the docs ..." type="search"/>
</form><nav aria-label="Main navigation" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
</div>
</nav>
</div>
<div class="d-none d-xl-block col-xl-2 bd-toc">
<div class="toc-item">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> On this page
</div>
<nav id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#configuration">
   Configuration
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#sliders-app">
   Sliders app
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#multiple-apps">
   Multiple apps
  </a>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
</li>
</ul>
</nav>
</div>
<div class="toc-item">
</div>
<a href="https://mybinder.org/v2/gh/holoviz/panel/v0.12.6?urlpath=lab/tree/examples/user_guide/FastApi_Apps.ipynb" style="padding-left: 1.5rem;">Open this page in Binder</a>
</div>
<main class="col-12 col-md-10 col-xl-8 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
<div>
<section id="fastapi-apps">
<h1>FastApi Apps<a class="headerlink" href="#fastapi-apps" title="Permalink to this headline">¶</a></h1>
<p>As the core user guides including the <a class="reference internal" href="../getting_started/Introduction.html"><span class="doc std std-doc">Introduction</span></a> have demonstrated, it is easy to display Panel apps in the notebook, launch them from an interactive Python prompt, and deploy them as a standalone Bokeh server app from the commandline. However, it is also often useful to embed a Panel app in large web application, such as a FastAPI web server. <a class="reference external" href="https://fastapi.tiangolo.com/">FastAPI</a> is especially useful compared to others like Flask and Django because of it’s lightning fast, lightweight framework. Using Panel with FastAPI requires a bit more work than for notebooks and Bokeh servers.</p>
<p>Following FastAPI’s <a class="reference external" href="https://fastapi.tiangolo.com/tutorial/">Tutorial - User Guide</a> make sure you first have FastAPI installed using: <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">fastapi</span></code>. Also make sure Panel is installed <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">panel</span></code>.</p>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Before we start adding a bokeh app to our FastApi server we have to set up some of the basic plumbing. In the <code class="docutils literal notranslate"><span class="pre">examples/apps/fastApi</span></code> folder we will add some basic configurations.</p>
<p>You’ll need to create a file called <code class="docutils literal notranslate"><span class="pre">examples/apps/fastApi/main.py</span></code>.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">main.py</span></code> you’ll need to import the following( which should all be already available from the above conda installs):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="kn">import</span> <span class="n">server_document</span>
<span class="kn">from</span> <span class="nn">panel.io.server</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Request</span>
<span class="kn">from</span> <span class="nn">fastapi.templating</span> <span class="kn">import</span> <span class="n">Jinja2Templates</span>
<span class="kn">from</span> <span class="nn">starlette.middleware.cors</span> <span class="kn">import</span> <span class="n">CORSMiddleware</span>
<span class="kn">from</span> <span class="nn">starlette.middleware</span> <span class="kn">import</span> <span class="n">Middleware</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="kn">import</span> <span class="n">IOLoop</span>
</pre></div>
</div>
<p>Each of these will be explained as we add them in.</p>
<p>Next we are going to need to create an instance of FastAPI below your imports in <code class="docutils literal notranslate"><span class="pre">main.py</span></code> and set up the path to your templates like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
<span class="n">templates</span> <span class="o">=</span> <span class="n">Jinja2Templates</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s2">"examples/apps/fastApi/templates"</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we are going to need to set up our middleware which will allow Panel to communicate with FastAPI. We will use starlette for this (Which FastAPI is built on). Add the following to your <code class="docutils literal notranslate"><span class="pre">main.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
    <span class="n">CORSMiddleware</span><span class="p">,</span>
    <span class="n">allow_origins</span><span class="o">=</span><span class="p">[</span><span class="s1">'*'</span><span class="p">],</span>
    <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
    <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We will now need to create our first rout via an async function and point it to the path of our server:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">bkapp_page</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">server_document</span><span class="p">(</span><span class="s1">'http://127.0.0.1:5000/app'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">templates</span><span class="o">.</span><span class="n">TemplateResponse</span><span class="p">(</span><span class="s2">"base.html"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"request"</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span> <span class="s2">"script"</span><span class="p">:</span> <span class="n">script</span><span class="p">})</span>
</pre></div>
</div>
<p>As you can see in this code we will also need to create an html  <a class="reference external" href="https://fastapi.tiangolo.com/advanced/templates/#using-jinja2templates">Jinja2</a> template. Create a new directory named <code class="docutils literal notranslate"><span class="pre">examples/apps/fastApi/templates</span></code> and create the file <code class="docutils literal notranslate"><span class="pre">examples/apps/fastApi/templates/base.html</span></code> in that directory.</p>
<p>Now add the following to <code class="docutils literal notranslate"><span class="pre">base.html</span></code>. This is a minimal version but feel free to add whatever else you need to it.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Panel in FastAPI: sliders<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        {{ script|safe }}
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Return back to your <code class="docutils literal notranslate"><span class="pre">examples/apps/fastApi/main.py</span></code> file. We will now need to add the function bk_worker() to start the bokeh server (Which Panel is built on). Configure it to whatever port you want, for our example we will use port 5000. This also uses a <a class="reference external" href="https://www.tornadoweb.org/en/stable/ioloop.html">tornado Iloop</a>. The <code class="docutils literal notranslate"><span class="pre">createApp</span></code> function call in this example is how we call our panel app. This is not set up yet but will be in the next section.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bk_worker</span><span class="p">():</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">({</span><span class="s1">'/app'</span><span class="p">:</span> <span class="n">createApp</span><span class="p">},</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">io_loop</span><span class="o">=</span><span class="n">IOLoop</span><span class="p">(),</span> 
        <span class="n">allow_websocket_origin</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">])</span>

    <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">server</span><span class="o">.</span><span class="n">io_loop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>We now will need to create a thread to call this function. Add the following code to your <code class="docutils literal notranslate"><span class="pre">examples/apps/fastApi/main.py</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">th</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">bk_worker</span><span class="p">)</span>
<span class="n">th</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">th</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="sliders-app">
<h2>Sliders app<a class="headerlink" href="#sliders-app" title="Permalink to this headline">¶</a></h2>
<p>Based on a standard FastAPI app template, this app shows how to integrate Panel and FastAPI.</p>
<p>The sliders app is in <code class="docutils literal notranslate"><span class="pre">examples/apps/fastApi/sliders</span></code>. We will cover the following additions/modifications to the Django2 app template:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sliders/sinewave.py</span></code>: a parameterized object (representing your pre-existing code)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sliders/pn_app.py</span></code>: creates an app function from the SineWave class</p></li>
</ul>
<p><img alt="screenshot of sliders app" src="../_images/sliders.png"/></p>
<p>To start with, in <code class="docutils literal notranslate"><span class="pre">sliders/sinewave.py</span></code> we create a parameterized object to serve as a placeholder for your own, existing code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">param</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColumnDataSource</span>
<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span>


<span class="k">class</span> <span class="nc">SineWave</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">))</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">))</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">frequency</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Number</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">))</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">x_range</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    <span class="n">y_range</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SineWave</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cds</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">plot_height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">plot_width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                           <span class="n">tools</span><span class="o">=</span><span class="s2">"crosshair, pan, reset, save, wheel_zoom"</span><span class="p">,</span>
                           <span class="n">x_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">'x'</span><span class="p">,</span> <span class="s1">'y'</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cds</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

    <span class="nd">@param</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">'N'</span><span class="p">,</span> <span class="s1">'frequency'</span><span class="p">,</span> <span class="s1">'amplitude'</span><span class="p">,</span> <span class="s1">'offset'</span><span class="p">,</span> <span class="s1">'phase'</span><span class="p">,</span> <span class="s1">'x_range'</span><span class="p">,</span> <span class="s1">'y_range'</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">update_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cds</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">x_range</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">x_range</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_range</span>

    <span class="k">def</span> <span class="nf">sine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<p>However the app itself is defined we need to configure an entry point, which is a function that accepts a bokeh Document and adds the application to it. In case of the slider app it looks like this in <code class="docutils literal notranslate"><span class="pre">sliders/pn_app.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">panel</span> <span class="k">as</span> <span class="nn">pn</span>

<span class="kn">from</span> <span class="nn">.sinewave</span> <span class="kn">import</span> <span class="n">SineWave</span>

<span class="k">def</span> <span class="nf">createApp</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
    <span class="n">sw</span> <span class="o">=</span> <span class="n">SineWave</span><span class="p">()</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="n">sw</span><span class="o">.</span><span class="n">param</span><span class="p">,</span> <span class="n">sw</span><span class="o">.</span><span class="n">plot</span><span class="p">)</span>
    <span class="n">row</span><span class="o">.</span><span class="n">server_doc</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
<p>We now need to return to our <code class="docutils literal notranslate"><span class="pre">main.py</span></code> and import the createApp function. Add the following import near the other imports:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sliders.pn_app</span> <span class="kn">import</span> <span class="n">createApp</span>
</pre></div>
</div>
<p>Your file structure should now be like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>fastApi
│   main.py
│
└───sliders
│   │   sinewave.py
│   │   pn_app.py
│
└───templates
    │   base.html
</pre></div>
</div>
<p>And your finished <code class="docutils literal notranslate"><span class="pre">main.py</span></code> should look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="kn">import</span> <span class="n">server_document</span>
<span class="kn">from</span> <span class="nn">panel.io.server</span> <span class="kn">import</span> <span class="n">Server</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">Request</span>
<span class="kn">from</span> <span class="nn">fastapi.templating</span> <span class="kn">import</span> <span class="n">Jinja2Templates</span>
<span class="kn">from</span> <span class="nn">starlette.middleware.cors</span> <span class="kn">import</span> <span class="n">CORSMiddleware</span>
<span class="kn">from</span> <span class="nn">starlette.middleware</span> <span class="kn">import</span> <span class="n">Middleware</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="kn">import</span> <span class="n">IOLoop</span>

<span class="kn">from</span> <span class="nn">sliders.pn_app</span> <span class="kn">import</span> <span class="n">createApp</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
<span class="n">templates</span> <span class="o">=</span> <span class="n">Jinja2Templates</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s2">"templates"</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span> <span class="c1"># Middleware to serve panel apps asynchronously via starlette</span>
    <span class="n">CORSMiddleware</span><span class="p">,</span>
    <span class="n">allow_origins</span><span class="o">=</span><span class="p">[</span><span class="s1">'*'</span><span class="p">],</span>
    <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
    <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
<span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">bkapp_page</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">server_document</span><span class="p">(</span><span class="s1">'http://127.0.0.1:5000/app'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">templates</span><span class="o">.</span><span class="n">TemplateResponse</span><span class="p">(</span><span class="s2">"base.html"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"request"</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span> <span class="s2">"script"</span><span class="p">:</span> <span class="n">script</span><span class="p">})</span>


<span class="k">def</span> <span class="nf">bk_worker</span><span class="p">():</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">({</span><span class="s1">'/app'</span><span class="p">:</span> <span class="n">createApp</span><span class="p">},</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">io_loop</span><span class="o">=</span><span class="n">IOLoop</span><span class="p">(),</span> 
        <span class="n">allow_websocket_origin</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">])</span>

    <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">server</span><span class="o">.</span><span class="n">io_loop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">th</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">bk_worker</span><span class="p">)</span>
<span class="n">th</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">th</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>You now will need to set an environment variable in order to determine which origins will be allowed to access your bokeh server. Add the following variable to your environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BOKEH_ALLOW_WS_ORIGIN</span><span class="o">=</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span>
</pre></div>
</div>
<p>This is for the default local host. You may need to change this to whatever your local host is.</p>
<p>If using a conda environment you can create this variable with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">env</span> <span class="n">config</span> <span class="nb">vars</span> <span class="nb">set</span> <span class="n">BOKEH_ALLOW_WS_ORIGIN</span><span class="o">=</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span>
</pre></div>
</div>
<p>Your app should be ready to run now. To run your newly created app. Type the following command or copy and paste into your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uvicorn</span> <span class="n">main</span><span class="p">:</span><span class="n">app</span> <span class="o">--</span><span class="n">reload</span>
</pre></div>
</div>
<p>The output should give you a link to go to to view your app:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Uvicorn</span> <span class="n">running</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">8000</span> <span class="p">(</span><span class="n">Press</span> <span class="n">CTRL</span><span class="o">+</span><span class="n">C</span> <span class="n">to</span> <span class="n">quit</span><span class="p">)</span>
</pre></div>
</div>
<p>Go to that address and your app should be there running!</p>
</section>
<section id="multiple-apps">
<h2>Multiple apps<a class="headerlink" href="#multiple-apps" title="Permalink to this headline">¶</a></h2>
<p>This is the most basic configuration for a bokeh server. It is of course possible to add multiple apps in the same way and then registering them with FastApi in the way described in the <a class="reference external" href="#Configuration">configuration</a> section above. To see a multi-app fastApi server have a look at <code class="docutils literal notranslate"><span class="pre">examples/apps/fastApi_multi_apps</span></code> and launch it with <code class="docutils literal notranslate"><span class="pre">uvicorn</span> <span class="pre">main:app</span> <span class="pre">--reload</span></code> as before.</p>
<p>To run multiple apps you will need to do the following:</p>
<ol class="simple">
<li><p>Create a new directory in your and a new file with your panel app (ex. <code class="docutils literal notranslate"><span class="pre">sinewave2.py</span></code>).</p></li>
<li><p>Create another pn_app file in your new directory (ex. <code class="docutils literal notranslate"><span class="pre">pn_app2.py</span></code>) That might look something like this:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">panel</span> <span class="k">as</span> <span class="nn">pn</span>

<span class="kn">from</span> <span class="nn">.sinewave</span> <span class="kn">import</span> <span class="n">SineWave2</span>

<span class="k">def</span> <span class="nf">createApp2</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
    <span class="n">sw</span> <span class="o">=</span> <span class="n">SineWave2</span><span class="p">()</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="n">sw</span><span class="o">.</span><span class="n">param</span><span class="p">,</span> <span class="n">sw</span><span class="o">.</span><span class="n">plot</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">row</span><span class="o">.</span><span class="n">server_doc</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
<p>With this as your new file structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>fastApi
│   main.py
│
└───sliders
│   │   sinewave.py
│   │   pn_app.py
│   │
└───sliders2
│   │   sinewave2.py
│   │   pn_app.py
│
└───templates
    │   base.html
</pre></div>
</div>
<ol class="simple">
<li><p>Create a new html template (ex. app2.html) with the same contents as base.html in <code class="docutils literal notranslate"><span class="pre">examples/apps/fastApi/templates</span></code></p></li>
<li><p>Import your new app in main.py <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">sliders2.pn_app</span> <span class="pre">import</span> <span class="pre">createApp2</span></code></p></li>
<li><p>Add your new app to the dictionary in bk_worker() Server</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">'/app'</span><span class="p">:</span> <span class="n">createApp</span><span class="p">,</span> <span class="s1">'/app2'</span><span class="p">:</span> <span class="n">createApp2</span><span class="p">}</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Add a new async function to rout your new app (The bottom of <code class="docutils literal notranslate"><span class="pre">main.py</span></code> should look something like this now):</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">bkapp_page</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">server_document</span><span class="p">(</span><span class="s1">'http://127.0.0.1:5000/app'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">templates</span><span class="o">.</span><span class="n">TemplateResponse</span><span class="p">(</span><span class="s2">"base.html"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"request"</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span> <span class="s2">"script"</span><span class="p">:</span> <span class="n">script</span><span class="p">})</span>
    
<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/app2"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">bkapp_page2</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">server_document</span><span class="p">(</span><span class="s1">'http://127.0.0.1:5000/app2'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">templates</span><span class="o">.</span><span class="n">TemplateResponse</span><span class="p">(</span><span class="s2">"app2.html"</span><span class="p">,</span> <span class="p">{</span><span class="s2">"request"</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span> <span class="s2">"script"</span><span class="p">:</span> <span class="n">script</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">bk_worker</span><span class="p">():</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="p">({</span><span class="s1">'/app'</span><span class="p">:</span> <span class="n">createApp</span><span class="p">,</span> <span class="s1">'/app2'</span><span class="p">:</span> <span class="n">createApp2</span><span class="p">},</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">io_loop</span><span class="o">=</span><span class="n">IOLoop</span><span class="p">(),</span> 
        <span class="n">allow_websocket_origin</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">])</span>

    <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">server</span><span class="o">.</span><span class="n">io_loop</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">th</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">bk_worker</span><span class="p">)</span>
<span class="n">th</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">th</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>With this as your file structure</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>fastApi
│   main.py
│
└───sliders
│   │   sinewave.py
│   │   pn_app.py
│   │
└───sliders2
│   │   sinewave2.py
│   │   pn_app.py
│
└───templates
    │   base.html
    │   app2.html 
</pre></div>
</div>
<p>Sliders 2 will be available at <code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/app2</span></code></p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>That’s it! You now have embedded panel in FastAPI! You can now build off of this to create your own web app tailored to your needs.</p>
</section>
<div id="scroller-right">This web page was generated from a Jupyter notebook and not all interactivity will work on this website. <a href="https://raw.githubusercontent.com/holoviz/panel/master/examples/user_guide/FastApi_Apps.ipynb">Right click to download and run locally</a> for full Python-backed interactivity.</div><hr class="docutils"/>
<p><a class="reference external" href="https://raw.githubusercontent.com/holoviz/panel/master/examples/user_guide/FastApi_Apps.ipynb">Right click to download this notebook from GitHub.</a></p>
</section>
</div>
<!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
</main>
</div>
</div>
<script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
<div class="container">
<div class="footer-item">
<p class="copyright">
    © Copyright 2019-2021 Panel contributors.<br/>
</p>
</div>
<div class="footer-item">
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.1.<br/>
</p>
</div>
</div>
</footer>
</body>
</html>